#!/bin/sh -ex

DB_NAME=cakephp
DB_USER=cakephp
DB_PASS=$(mcookie)

SRC=/usr/local/src
WEBROOT=/var/www/cakephp

# unpack and set permissions
unzip $SRC/cakephp-*.zip -d $(dirname $WEBROOT)
mv $(dirname $WEBROOT)/cakephp-* $WEBROOT
rm $SRC/cakephp-*.zip
chown -R root:root $WEBROOT
chown -R www-data:www-data $WEBROOT/app/tmp

# tweak configuration
CONF=$WEBROOT/app/Config/core.php
sed -i "s|Security.salt.*|Security.salt', '$(mcookie)');|" $CONF
sed -i "s|Security.cipherSeed.*|Security.cipherSeed', '$(mcookie)');|" $CONF
chown www-data:www-data $CONF
chmod 640 $CONF

